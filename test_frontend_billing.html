<!DOCTYPE html>
<html>
<head>
    <title>Test Frontend Billing</title>
</head>
<body>
    <h1>Frontend Billing Test</h1>
    <button id="testBtn">Send Test Message</button>
    <div id="results"></div>
    
    <script>
        // Simulate the SSE parser billing event handling
        function simulateBillingEvent() {
            const mockBillingEvent = {
                type: "billing",
                content: "Billed 1.0 credits: 1 model calls, 0 tool calls",
                timestamp: new Date().toISOString(),
                session_id: "test_session",
                data: {
                    success: true,
                    model_calls: 1,
                    tool_calls: 0,
                    total_credits: 1.0,
                    credits_remaining: 999.0,
                    error_message: null
                }
            };
            
            console.log('üß™ Testing billing event processing...');
            console.log('üí∞ Mock billing event:', mockBillingEvent);
            
            // Simulate what our SSEParser.handleBillingEvent would do
            if (mockBillingEvent.data?.success && mockBillingEvent.data.credits_remaining !== undefined) {
                const billingData = {
                    creditsRemaining: mockBillingEvent.data.credits_remaining,
                    totalCredits: mockBillingEvent.data.total_credits || mockBillingEvent.data.credits_remaining,
                    modelCalls: mockBillingEvent.data.model_calls || 0,
                    toolCalls: mockBillingEvent.data.tool_calls || 0
                };
                
                console.log('‚úÖ Billing data extracted successfully:', billingData);
                console.log('üí≥ Credits remaining would be updated to:', billingData.creditsRemaining);
                
                // This would trigger userStore.updateCredits(billingData.creditsRemaining)
                document.getElementById('results').innerHTML = `
                    <h3>‚úÖ Billing Event Processed Successfully!</h3>
                    <p><strong>Credits Remaining:</strong> ${billingData.creditsRemaining}</p>
                    <p><strong>Model Calls:</strong> ${billingData.modelCalls}</p>
                    <p><strong>Tool Calls:</strong> ${billingData.toolCalls}</p>
                    <p><strong>Total Credits Used:</strong> ${billingData.totalCredits}</p>
                `;
            } else {
                console.log('‚ùå Billing data structure is invalid');
                document.getElementById('results').innerHTML = '<h3>‚ùå Billing Event Failed</h3>';
            }
        }
        
        document.getElementById('testBtn').addEventListener('click', simulateBillingEvent);
    </script>
</body>
</html>